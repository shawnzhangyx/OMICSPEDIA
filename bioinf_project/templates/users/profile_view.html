{% extends "users/user_base.html" %}
{% load tag_custom_tags %}
{% load post_custom_tags %}
{% load wiki_custom_tags %}
{% load software_custom_tags %}
{% load staticfiles %}
{% load humanize %}

{% block content %}
<h2> <span class="pull-left">{{userprofile.name}}&nbsp;&nbsp;</span>
{% if user.is_authenticated %}
    {% if user.user_profile.id != userprofile.id %}
<form class="form pull-left" action="{% url 'users:change-follow' userprofile.id %}?next={{request.path}}" method="post">
{% csrf_token %}
<input style="display:none;" value="{{user.user_profile.id}}" name="follower"/> 
{{form.as_p}}
{% if userprofile in user.user_profile.following.all %} <button class="btn btn-xs btn-error"> Unfollow </button>
{%else%}<button class="btn btn-xs btn-info">Follow</button> {% endif %}
</form>
    {% endif %}
{% endif %}
<span>&nbsp;&nbsp;</span>
</h2>

{% if user == userprofile.user %} 
    {% if user.email_verified == False %}
        <div class="alert alert-warning"> 
        You e-mail has not been verified therefore your account is limited. Would you like to 
            <a href="{% url 'users:email-verification-form' ''%}"> verify your e-mail address </a> now? 
        </div>
    {% endif %}
{% endif %}

<div class="row">
	<div class="profile-img"> 
        {% if userprofile.portrait %}
            <img class="profile-img-big" src="{{userprofile.portrait.url}}">
        {% else %}
            <img class="profile-img-big" src='{% static "images/user_default.png"%}'>
        {% endif %}
        <div class="profile-follow">
            <strong class="profile-follow-num"><a href="{% url 'users:following' userprofile.pk %}">{{userprofile.following.count}}</a></strong> <br><p>following</p>
        </div>
        <div class="profile-follow">
            <strong class="profile-follow-num"><a href="{% url 'users:followers' userprofile.pk %}">{{userprofile.follower.count}}</a></strong> <br>follower
        </div>
	</div>
	<div class="profile-info">
	  <table class="table">
        <tr> <td>Website</td><td> <a href="{{userprofile.website}}"> {{userprofile.website}}</a> </td></tr>
        <tr> <td>Location</td><td> {{userprofile.location}} </td></tr>
        <tr> <td>Member since</td><td> {{userprofile.date_joined|naturaltime}} </td></tr>
        <tr> <td>Last seen</td><td> {{userprofile.last_activity|naturaltime}} </td></tr>

	    <tr> <td>Reputation</td><td> {{userprofile.reputation}} </td></tr>
	  </table>
	</div>
	<div class="profile-bio">
		<b>About me:</b>
         {{userprofile.biography}}
	</div>
</div>
<hr>
<div class="">
<div class="section-tab col-sm-6">
<h3> {{userprofile.user.questions.count}} question{% if userprofile.user.questions.count > 1%}s{%endif%} </h3>

{% for post in userprofile.user.questions.all %}
    {% show_post_tab_sm post %}
{% endfor %}
</div>

<div class="section-tab col-sm-6 ">
<h3> {{userprofile.user.replypost_set.count}} answer{% if userprofile.user.replypost_set.count > 1%}s{%endif%}</h3>
<div>
{% for replypost in userprofile.user.replypost_set.all %}
  <div class="post-tab-sm col-sm-12">
  <div class="post-count-box-sm">
    <div class="post-tab-reply-sm {% if replypost.accepted_root.count == 1 %}post-tab-reply-accepted{% endif %}">
    {{replypost.get_vote_count}}
    </div>
  </div>
  <div>
    <a class="post-tab-title-sm" href= "{% url 'posts:post-detail' replypost.mainpost.id %}" >{{ replypost.mainpost.title }} </a>
  </div>
    </div>
{% endfor %}
</div> 
</div>

<div class="clearfix visible-sm-block visible-md-block visible-lg-block"></div>

<div class="section-tab col-sm-6">
<h3> {{userprofile.user.discussions.count}} discussion{% if userprofile.user.discussions.count > 1%}s{%endif%} </h3>
{% for post in userprofile.user.discussions.all %}
    {% show_post_tab_sm post %}
{% endfor %}
</div>

<div class="section-tab col-sm-6">
<h3> {{userprofile.user.blogs.count}} blog{% if userprofile.user.blogs.count > 1%}s{%endif%} </h3>
{% for post in userprofile.user.blogs.all %}
    {% show_post_tab_sm post %}
{% endfor %}
</div>

<div class="clearfix visible-sm-block visible-md-block visible-lg-block"></div>

<div class="section-tab col-sm-6" id="profile-view-bookmark">
    <h3> {{userprofile.user.bookmarks.count}} bookmark{% if userprofile.user.bookmarks.count > 1%}s{% endif %}
    <small class="profile-view-tab-choice profile-view-tab-choice-on" target="bookmark-wiki-list"> wiki<sup>{{bookmark_wiki.count}}</sup> </small>
    <small class="profile-view-tab-choice profile-view-tab-choice-off" target="bookmark-post-list"> post<sup>{{bookmark_posts.count}}</sup> </small>
    <small class="profile-view-tab-choice profile-view-tab-choice-off" target="bookmark-software-list"> software<sup>{{bookmark_software.count}}</sup> </small>
</h3>
<div id="bookmark-wiki-list">
{% for wiki in bookmark_wiki %}
        {% show_wiki_tab wiki %}
{% endfor %}
</div>
<div id="bookmark-post-list">
{% for post in bookmark_posts %}
    {% show_post_tab_sm post %}
{% endfor %}
</div>
<div id="bookmark-software-list">
{% for software in bookmark_software %}
{% display_software_tab_sm software %}
{% endfor %}
</div>

</div>
<div class="section-tab col-sm-6 ">
<h3> {{usertag_list.count}} tag{% if usertag_list.count > 1 %}s{% endif %} </h3>
    <ul class="list-unstyled" >
    {% for user_tag in usertag_list %}
        {% tag_answers_for_user user_tag %}
    {% endfor %}
    </ul>
    
</div>
<div class="clearfix visible-sm-block visible-md-block visible-lg-block"></div>

</div>

<hr>
  {% if user == userprofile.user %}
    <a class="btn btn-default btn-sm" href = "{% url 'users:profile-edit' user.user_profile.id %}"> Edit profile? </a>
    <a class="btn btn-default btn-sm" href = "{% url 'users:password-change' %}"> Change Password? </a>
    <a class="btn btn-default btn-sm" href = "{% url 'users:logout' %}?next={{request.path}}"> log out? </a>
  {% endif %}
<br><br>
{% endblock content %}


{% block jquery %}
  <script src="{% static 'jquery/profile-view.js' %}"> </script>
{% endblock jquery %}
